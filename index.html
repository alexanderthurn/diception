<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DICEPTION</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="loading-screen">
        <h1 class="tron-title">DICEPTION</h1>
        <div class="loading-status">INITIALIZING SYSTEM...</div>
        <div id="loading-version" class="loading-version"></div>
    </div>

    <div id="game-container"></div>

    <!-- Turn indicator (shown above playfield in Beginner mode) -->
    <div id="turn-indicator" class="game-ui hidden"></div>

    <!-- Dice result HUD (shown below playfield in Beginner mode) -->
    <div id="dice-result-hud" class="game-ui hidden">
        <div id="dice-result-content"></div>
    </div>

    <div id="fps-counter" class="hidden">FPS: 00</div>

    <div id="ui-overlay">
        <button id="end-turn-btn" class="tron-btn game-ui hidden">End Turn</button>
        <button id="auto-win-btn" class="tron-btn game-ui hidden" title="Toggle Autoplay">ü§ñ</button>

        <div id="music-controls" class="panel">
            <button id="new-game-btn" class="tron-btn small game-ui hidden" title="New Game"><span class="btn-text">NEW
                    GAME</span><span class="btn-icon">‚öôÔ∏è</span></button>
            <span class="separator"></span>
            <div class="audio-group">
                <button id="music-toggle" class="tron-btn small" title="Music">üîá</button>
                <input type="range" id="music-volume" min="0" max="100" value="50" title="Music Volume">
            </div>
            <span class="separator"></span>
            <div class="audio-group">
                <button id="sfx-toggle" class="tron-btn small active" title="Sound Effects">üîî</button>
                <input type="range" id="sfx-volume" min="0" max="100" value="50" title="SFX Volume">
            </div>
            <span class="separator game-ui hidden zoom-control"></span>
            <button id="zoom-out-btn" class="tron-btn small zoom-control game-ui hidden" title="Zoom Out">‚ûñ</button>
            <button id="zoom-in-btn" class="tron-btn small zoom-control game-ui hidden" title="Zoom In">‚ûï</button>
        </div>



        <div id="setup-modal" class="modal">
            <h1 class="tron-title">DICEPTION</h1>
            <div class="credits">by Alexander Thurn</div>
            <div class="control-group">
                <label id="map-size-label">Map Size</label>
                <div class="map-size-row">
                    <button id="loaded-scenario-name" class="tron-btn loaded-scenario-text"
                        style="display: none;"></button>
                    <input type="range" id="map-size" min="1" max="10" value="2">
                    <span id="map-size-val">4x4</span>
                    <button id="scenarios-btn" class="tron-btn small" title="Load Scenario">üìã</button>
                </div>
            </div>


            <div class="control-row">
                <div class="control-group half" id="map-style-group">
                    <label>Map Style</label>
                    <select id="map-style">
                        <option value="random" selected>Random</option>
                        <option value="full">Full Grid</option>
                        <option value="continents">Continents</option>
                        <option value="caves">Caves</option>
                        <option value="islands">Islands</option>
                        <option value="maze">Maze</option>
                        <option value="tunnels">Tunnels</option>
                        <option value="swiss">Swiss Cheese</option>
                    </select>
                </div>
                <div class="control-group half">
                    <label>Start Mode</label>
                    <select id="game-mode">
                        <option value="classic" selected>Classic</option>
                        <option value="fair">Fair Start</option>
                        <option value="madness">Full Madness</option>
                        <option value="2of2">2 of 2</option>
                    </select>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group quarter">
                    <label>Humans</label>
                    <select id="human-count">
                        <option value="0">0</option>
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>
                <div class="control-group quarter">
                    <label>Bots</label>
                    <select id="bot-count">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3" selected>3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>
                <div class="control-group half">
                    <label>Bot AI</label>
                    <select id="bot-ai-select">
                        <option value="easy" selected>Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>

            <div class="control-row" id="tournament-config" style="display: none; margin-top: 10px;">
                <div class="control-group">
                    <label>Tournament Games</label>
                    <div class="range-row">
                        <input type="number" id="tournament-games" min="1" max="10000" value="100"
                            style="width: 100px;">
                        <button id="run-tournament-btn" class="tron-btn small">‚ñ∂ Run Tournament</button>
                    </div>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group half">
                    <label>Max Dice per Territory</label>
                    <div class="range-row">
                        <input type="range" id="max-dice" min="2" max="16" value="9">
                        <span id="max-dice-val">9</span>
                    </div>
                </div>
                <div class="control-group half">
                    <label>Dice Sides</label>
                    <div class="range-row">
                        <input type="range" id="dice-sides" min="1" max="16" value="6">
                        <span id="dice-sides-val">6</span>
                    </div>
                </div>
            </div>

            <div class="control-row" style="margin-top: 10px;">
                <div class="control-group half">
                    <label>Game Speed</label>
                    <select id="game-speed">
                        <option value="beginner" selected>Beginner</option>
                        <option value="normal">Normal</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>
                <div class="control-group half">
                    <label>Visual Effects</label>
                    <select id="effects-quality">
                        <option value="high">High</option>
                        <option value="medium" selected>Medium</option>
                        <option value="off">Off</option>
                    </select>
                </div>
            </div>

            <div class="control-row" style="margin-top: 20px; gap: 10px;">
                <button id="howto-btn" class="tron-btn small" style="flex: 0 0 auto; width: auto; padding: 0 15px;"
                    title="How to Play">?</button>
                <div style="flex: 1; display: flex; flex-direction: column; gap: 10px; align-items: flex-end;">
                    <button id="start-game-btn" class="tron-btn large" style="width: 100%;">START</button>
                    <button id="quit-game-btn" class="tron-btn small hidden" style="width: 100%; padding: 10px;"
                        title="Quit Game">EXIT</button>
                </div>
            </div>
        </div>



        <div id="howto-modal" class="modal hidden large-modal">
            <div class="modal-header">
                <h2 class="tron-title small">DICEPTION</h2>
                <button id="howto-close-btn" class="close-btn">√ó</button>
            </div>
            <div class="howto-content">
                <section>
                    <h3>PROTOCOL: BASICS</h3>
                    <p><strong>OBJECTIVE:</strong> Conquer all tiles of the grid.</p>
                    <ul class="howto-list">
                        <li><strong>COMBAT:</strong> Dice attack dice. Your attack power is the sum of all your dice
                            values. Highest sum wins.</li>
                        <li><strong>WINNING:</strong> If you have a higher total than the defender, you win. You take
                            over the territory and move your dice there (leaving 1 behind).</li>
                        <li><strong>LOSING:</strong> If you have equal or fewer points, you lose. Your dice count drops
                            to 1 and your turn ends immediately.</li>
                        <li><strong>REINFORCE:</strong> At the end of your turn, you get new dice. You get dice based on
                            your biggest connected territories amount. Like if you have 3 territories, but only 2 are
                            adjacent, you get 2 dice.</li>
                    </ul>
                </section>

                <section>
                    <h3>INTERFACE CONTROLS</h3>
                    <table class="control-table">
                        <tr>
                            <th>Action</th>
                            <th>Keyboard</th>
                            <th>Gamepad</th>
                        </tr>
                        <tr>
                            <td>Navigate Cursor</td>
                            <td>-</td>
                            <td>Left Stick</td>
                        </tr>
                        <tr>
                            <td>Select / Attack</td>
                            <td>Enter / E</td>
                            <td>A Button</td>
                        </tr>
                        <tr>
                            <td>Attack Neighbor</td>
                            <td>WASD / Arrows</td>
                            <td>D-Pad</td>
                        </tr>
                        <tr>
                            <td>Cancel / Deselect</td>
                            <td>Q</td>
                            <td>X Button</td>
                        </tr>
                        <tr>
                            <td>End Turn</td>
                            <td>Space / R</td>
                            <td>Y Button</td>
                        </tr>
                        <tr>
                            <td>Camera Pan</td>
                            <td>I J K L</td>
                            <td>Right Stick / B (Hold)</td>
                        </tr>
                        <tr>
                            <td>Zoom</td>
                            <td>Wheel</td>
                            <td>L2 / R2</td>
                        </tr>
                        <tr>
                            <td>Cursor Speed</td>
                            <td>-</td>
                            <td>L1 / R1</td>
                        </tr>
                    </table>
                </section>

                <section>
                    <h3>SYSTEM CONFIGURATION</h3>
                    <div class="setting-explain">
                        <p><strong>Config:</strong></p>
                        <ul>
                            <li><em>Map Size:</em> Controls the dimensions of the grid. Larger maps take longer to
                                conquer.</li>
                            <li><em>Map Style:</em> Shape of the world (e.g., Continents, Maze, Swiss Cheese). Affects
                                movement paths.</li>
                            <li><em>Start Mode:</em> "Classic" gives each player a reasonable amount of dice, but the
                                later you start the more dice you get (+1 per player).
                                "Fair Start" gives everyone equal. "2 of 2": every country has 2 dices, "full madness":
                                every country is fully stacked.</li>
                            <li><em>Max Dice:</em> The maximum number of dice a single tile can hold.</li>
                            <li><em>Dice Sides:</em> A normal dice has 6 sides. Here you can change that. Values always
                                start with 1,2,3,...</li>
                            <li><em>Humans:</em> Set number of human players.</li>
                            <li><em>Bots:</em> Set number of AIs</li>
                            <li><em>Game Speed:</em> <strong>Beginner</strong> shows all rolls and animations.
                                <strong>Normal</strong> is standard. <strong>Expert</strong> skips most animations.
                            </li>
                            <li><em>Visual Effects:</em> "High" for full neon glow with particles. "Low/Off" for better
                                performance on
                                slow devices.</li>
                        </ul>
                    </div>
                </section>

                <section>
                    <h3>ABOUT</h3>
                    <div class="setting-explain">
                        <p>This game was made by <strong>Alexander Thurn</strong>.</p>
                        <p>It is <strong>open source</strong> and free to use and modify under the <strong>MIT
                                License</strong>.</p>
                        <p>GitHub: <a href="https://github.com/alexanderthurn/diception" target="_blank"
                                class="about-link highlight-link">alexanderthurn/diception</a></p>
                        <p>Visit <a href="https://feuerware.com" target="_blank"
                                class="about-link  highlight-link">feuerware.com</a>
                            for more games.</p>
                    </div>
                </section>
            </div>
        </div>

        <div id="player-dashboard" class="panel game-ui hidden">
            <h3 class="dash-header" id="dash-header">
                <span id="player-turn">Initializing...</span>
                <span id="dash-toggle">[-]</span>
            </h3>
            <div id="dash-content">
                <div id="player-list">
                    <!-- Populated by JS -->
                </div>
                <hr class="dash-divider">
                <h4 class="log-title">BATTLE LOG</h4>
                <div id="log-entries">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <div id="game-over-modal" class="modal hidden">
            <h1>GAME OVER</h1>
            <p id="winner-text"></p>
            <div id="highscore-section">
                <h3 class="highscore-title">üèÜ PLAYER STATS</h3>
                <div id="highscore-list"></div>
                <div id="total-games-played" class="total-games"></div>
            </div>
            <div class="game-over-actions">
                <button id="restart-btn" class="tron-btn">New Game</button>
                <button id="clone-game-btn" class="tron-btn">Try Again</button>
            </div>
        </div>

        <!-- Tournament Results Modal -->
        <div id="tournament-results-modal" class="modal hidden">
            <div class="modal-header">
                <h2 class="tron-title small">TOURNAMENT RESULTS</h2>
                <button id="tournament-close-btn" class="close-btn">√ó</button>
            </div>
            <div id="tournament-results"></div>
            <div class="tournament-actions">
                <button id="tournament-again-btn" class="tron-btn">Run Again</button>
                <button id="tournament-done-btn" class="tron-btn">Done</button>
            </div>
        </div>

        <!-- Scenario Browser Modal -->
        <div id="scenario-browser-modal" class="modal hidden wide-modal">
            <div class="modal-header compact-header">
                <div class="scenario-tabs header-tabs">
                    <button class="scenario-tab active" data-tab="maps">üó∫Ô∏è Maps</button>
                    <button class="scenario-tab" data-tab="scenarios">‚≠ê Scenarios</button>
                    <button class="scenario-tab" data-tab="online">üåê Online</button>
                </div>
                <button id="scenario-browser-close-btn" class="close-btn">√ó</button>
            </div>
            <div class="scenario-browser-content split-view">
                <div class="scenario-browser-left">
                    <div class="scenario-list-container">
                        <div id="scenario-list"></div>
                    </div>
                    <div class="scenario-left-actions">
                        <button id="new-scenario-btn" class="tron-btn small full-width">
                            + New Map
                        </button>
                    </div>
                </div>
                <div class="scenario-browser-right">
                    <div id="scenario-preview-content">
                        <!-- Preview content injected here -->
                        <div class="empty-message-large">
                            Select a scenario to view details
                        </div>
                    </div>
                    <div class="scenario-right-actions" style="display: none;">
                        <button id="scenario-export-btn" class="tron-btn small" disabled>
                            üíæ <span class="btn-text">Export as file</span>
                        </button>
                        <button id="scenario-import-btn" class="tron-btn small">
                            üì• <span class="btn-text">Import</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Map/Scenario Editor Overlay (uses main game canvas) -->
        <div id="editor-overlay" class="editor-overlay hidden">
            <!-- Top bar with title and close -->
            <div class="editor-top-bar">
                <button id="editor-back-btn" class="tron-btn small">‚Üê Back</button>
                <h2 class="tron-title small">MAP EDITOR</h2>
                <button id="editor-close-btn" class="close-btn">√ó</button>
            </div>

            <!-- Bottom toolbar -->
            <div class="editor-bottom-bar">
                <!-- Mode tabs -->
                <div class="editor-mode-tabs">
                    <button class="editor-tab active" data-mode="paint">üñåÔ∏è Paint</button>
                    <button class="editor-tab" data-mode="assign">üë§ Assign</button>
                    <button class="editor-tab" data-mode="dice"><span class="dice-icon-sprite mini" style="background-color: #888;"></span> Dice</button>
                </div>

                <!-- Mode-specific toolbar -->
                <div class="editor-toolbar">
                    <div id="paint-toolbar" class="toolbar-section">
                        <label>Tile:</label>
                        <div id="paint-palette" class="paint-palette"></div>
                    </div>
                    <div id="assign-toolbar" class="toolbar-section hidden">
                        <label>Player:</label>
                        <div id="player-palette" class="player-palette"></div>
                    </div>
                    <div id="dice-toolbar" class="toolbar-section hidden">
                        <label>Dice:</label>
                        <div id="dice-palette" class="dice-palette"></div>
                    </div>
                </div>
            </div>

            <!-- Right settings panel -->
            <div class="editor-settings">

                <div class="control-group">
                    <label>Name</label>
                    <input type="text" id="editor-name" placeholder="My Map" maxlength="40">
                </div>

                <div class="control-group">
                    <label>Description</label>
                    <input type="text" id="editor-description" placeholder="Optional description" maxlength="100">
                </div>

                <div class="control-group">
                    <label>Author</label>
                    <input type="text" id="editor-author" placeholder="Author name" maxlength="40">
                </div>

                <hr class="editor-divider">

                <div class="control-row">
                    <div class="control-group half">
                        <label>Width</label>
                        <div class="range-row">
                            <input type="range" id="editor-width" min="3" max="20" value="7">
                            <span id="editor-width-val">7</span>
                        </div>
                    </div>
                    <div class="control-group half">
                        <label>Height</label>
                        <div class="range-row">
                            <input type="range" id="editor-height" min="3" max="20" value="7">
                            <span id="editor-height-val">7</span>
                        </div>
                    </div>
                </div>

                <hr class="editor-divider">

                <div class="control-group" id="editor-players-section">
                    <label>Players <span id="player-count-display">(2)</span></label>
                    <div id="editor-player-list" class="editor-player-list"></div>
                    <button id="add-player-btn" class="tron-btn small">+ Add Player</button>
                </div>

                <hr class="editor-divider">

                <div class="control-row" id="editor-dice-settings-section">
                    <div class="control-group half">
                        <label>Max Dice</label>
                        <div class="range-row">
                            <input type="range" id="editor-max-dice" min="2" max="16" value="9">
                            <span id="editor-max-dice-val">9</span>
                        </div>
                    </div>
                    <div class="control-group half">
                        <label>Dice Sides</label>
                        <div class="range-row">
                            <input type="range" id="editor-dice-sides" min="1" max="16" value="6">
                            <span id="editor-dice-sides-val">6</span>
                        </div>
                    </div>
                </div>

                <hr class="editor-divider">

                <div class="editor-actions">
                    <button id="save-as-map-btn" class="tron-btn">üíæ Save as Map</button>
                    <button id="save-as-scenario-btn" class="tron-btn">üíæ Save as Scenario</button>
                </div>

                <div class="editor-quick-actions">
                    <button id="editor-clear-btn" class="tron-btn small">Clear</button>
                    <button id="editor-fill-btn" class="tron-btn small">Fill</button>
                </div>
            </div>

            <!-- Cursor Preview -->
            <div id="editor-cursor-preview" class="cursor-preview hidden">
                <div class="preview-box primary">
                    <span class="preview-label">L</span>
                    <div class="preview-content"></div>
                </div>
                <!-- Spacer -->
                <div style="width: 10px;"></div>
                <div class="preview-box secondary">
                    <span class="preview-label">R</span>
                    <div class="preview-content"></div>
                </div>
            </div>
        </div>

        <!-- Quit Confirmation Modal -->
        <div id="quit-confirm-modal" class="modal hidden">
            <h1 class="tron-title">QUIT GAME?</h1>
            <p style="margin-bottom: 20px;">Are you sure you want to exit to desktop?</p>
            <div class="control-row" style="justify-content: center; gap: 20px;">
                <button id="quit-confirm-btn" class="tron-btn large danger"
                    style="width: 140px; border-color: #ff3333; color: #ff3333;">QUIT</button>
                <button id="quit-cancel-btn" class="tron-btn large" style="width: 140px;">CANCEL</button>
            </div>
        </div>

        <!-- Save Scenario Modal -->
        <div id="save-scenario-modal" class="modal hidden">
            <div class="modal-header">
                <h2 class="tron-title small">SAVE SCENARIO</h2>
                <button id="save-scenario-close-btn" class="close-btn">√ó</button>
            </div>
            <div class="save-scenario-content">
                <div class="control-group">
                    <label>Scenario Name</label>
                    <input type="text" id="scenario-name-input" placeholder="My Epic Battle" maxlength="40">
                </div>
                <div class="save-scenario-info">
                    <p>This will save the current game state including:</p>
                    <ul>
                        <li>Map layout and size</li>
                        <li>All player positions and dice counts</li>
                        <li>Player colors and types</li>
                    </ul>
                </div>
                <div class="save-scenario-actions">
                    <button id="save-scenario-confirm-btn" class="tron-btn">üíæ Save</button>
                    <button id="save-scenario-cancel-btn" class="tron-btn small">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>

</html>