<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>DICEPTION</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="loading-screen">
        <h1 class="tron-title">DICEPTION</h1>
        <div class="loading-status">INITIALIZING SYSTEM...</div>
    </div>

    <div id="game-container"></div>

    <!-- Turn indicator (shown above playfield in Beginner mode) -->
    <div id="turn-indicator" class="game-ui hidden"></div>

    <!-- Dice result HUD (shown below playfield in Beginner mode) -->
    <div id="dice-result-hud" class="game-ui hidden">
        <div id="dice-result-content"></div>
    </div>

    <div id="ui-overlay">
        <button id="end-turn-btn" class="tron-btn game-ui hidden">End Turn</button>
        <button id="auto-win-btn" class="tron-btn game-ui hidden" title="Toggle Autoplay">ü§ñ</button>

        <div id="music-controls" class="panel">
            <button id="new-game-btn" class="tron-btn small game-ui hidden" title="New Game"><span class="btn-text">NEW
                    GAME</span><span class="btn-icon">‚öôÔ∏è</span></button>
            <span class="separator"></span>
            <button id="music-toggle" class="tron-btn small" title="Music">üîá</button>
            <input type="range" id="music-volume" min="0" max="100" value="50" title="Music Volume">
            <span class="separator"></span>
            <button id="sfx-toggle" class="tron-btn small active" title="Sound Effects">üîî</button>
            <input type="range" id="sfx-volume" min="0" max="100" value="50" title="SFX Volume">
        </div>

        <div id="setup-modal" class="modal">
            <h1 class="tron-title">DICEPTION</h1>
            <div class="credits">by Alexander Thurn</div>
            <div class="control-group">
                <label>Map Size</label>
                <div class="map-size-row">
                    <input type="range" id="map-size" min="1" max="10" value="5">
                    <span id="map-size-val">7x7</span>
                    <button id="scenarios-btn" class="tron-btn small" title="Load Scenario">üìã</button>
                </div>
            </div>


            <div class="control-row">
                <div class="control-group half">
                    <label>Map Style</label>
                    <select id="map-style">
                        <option value="random" selected>Random</option>
                        <option value="full">Full Grid</option>
                        <option value="continents">Continents</option>
                        <option value="caves">Caves</option>
                        <option value="islands">Islands</option>
                        <option value="maze">Maze</option>
                        <option value="tunnels">Tunnels</option>
                        <option value="swiss">Swiss Cheese</option>
                    </select>
                </div>
                <div class="control-group half">
                    <label>Start Mode</label>
                    <select id="game-mode">
                        <option value="classic" selected>Classic</option>
                        <option value="fair">Fair Start</option>
                        <option value="madness">Full Madness</option>
                        <option value="2of2">2 of 2</option>
                    </select>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group quarter">
                    <label>Humans</label>
                    <select id="human-count">
                        <option value="0">0</option>
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>
                <div class="control-group quarter">
                    <label>Bots</label>
                    <select id="bot-count">
                        <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3" selected>3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>
                <div class="control-group half">
                    <label>Bot AI</label>
                    <div class="select-with-btn">
                        <select id="bot-ai-select">
                            <option value="easy" selected>Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                            <option value="adaptive">Adaptive</option>
                            <option value="custom">Custom per bot...</option>
                            <!-- Custom AIs added dynamically -->
                        </select>
                        <button id="manage-ais-btn" class="tron-btn small" title="Manage AIs">‚öôÔ∏è</button>
                    </div>
                </div>
            </div>

            <!-- Per-player AI selection (shown when "Custom per bot" selected) -->
            <div class="control-row" id="per-player-ai-config" style="display: none;">
                <div class="control-group" style="width: 100%;">
                    <label>AI per Bot</label>
                    <div id="per-player-ai-list"></div>
                </div>
            </div>

            <div class="control-row" id="tournament-config" style="display: none; margin-top: 10px;">
                <div class="control-group">
                    <label>Tournament Games</label>
                    <div class="range-row">
                        <input type="number" id="tournament-games" min="1" max="10000" value="100"
                            style="width: 100px;">
                        <button id="run-tournament-btn" class="tron-btn small">‚ñ∂ Run Tournament</button>
                    </div>
                </div>
            </div>

            <div class="control-row">
                <div class="control-group half">
                    <label>Max Dice per Territory</label>
                    <div class="range-row">
                        <input type="range" id="max-dice" min="2" max="16" value="9">
                        <span id="max-dice-val">9</span>
                    </div>
                </div>
                <div class="control-group half">
                    <label>Dice Sides</label>
                    <div class="range-row">
                        <input type="range" id="dice-sides" min="2" max="20" value="6">
                        <span id="dice-sides-val">6</span>
                    </div>
                </div>
            </div>

            <div class="control-row" style="margin-top: 10px;">
                <div class="control-group half">
                    <label>Game Speed</label>
                    <select id="game-speed">
                        <option value="beginner" selected>Beginner</option>
                        <option value="normal">Normal</option>
                        <option value="expert">Expert</option>
                    </select>
                </div>
                <div class="control-group half">
                    <label>Visual Effects</label>
                    <select id="effects-quality">
                        <option value="high">High</option>
                        <option value="low">Low</option>
                        <option value="off">Off</option>
                    </select>
                </div>
            </div>

            <div class="control-row" style="margin-top: 20px; gap: 10px;">
                <button id="howto-btn" class="tron-btn small" style="flex: 0 0 auto; width: auto; padding: 0 15px;"
                    title="How to Play">?</button>
                <button id="start-game-btn" class="tron-btn large" style="flex: 1;">START</button>
            </div>
        </div>

        <div id="howto-modal" class="modal hidden large-modal">
            <div class="modal-header">
                <h2 class="tron-title small">DICEPTION</h2>
                <button id="howto-close-btn" class="close-btn">√ó</button>
            </div>
            <div class="howto-content">
                <section>
                    <h3>PROTOCOL: BASICS</h3>
                    <p><strong>OBJECTIVE:</strong> Conquer all tiles of the grid.</p>
                    <ul class="howto-list">
                        <li><strong>COMBAT:</strong> Dice attack dice. Your attack power is the sum of all your dice
                            values. Highest sum wins.</li>
                        <li><strong>WINNING:</strong> If you have a higher total than the defender, you win. You take
                            over the territory and move your dice there (leaving 1 behind).</li>
                        <li><strong>LOSING:</strong> If you have equal or fewer points, you lose. Your dice count drops
                            to 1 and your turn ends immediately.</li>
                        <li><strong>REINFORCE:</strong> At the end of your turn, you get new dice. You get dice based on
                            your biggest connected territories amount. Like if you have 3 territories, but only 2 are
                            adjacent, you get 2 dice.</li>
                    </ul>
                </section>

                <section>
                    <h3>INTERFACE CONTROLS</h3>
                    <table class="control-table">
                        <tr>
                            <th>Action</th>
                            <th>Keyboard</th>
                            <th>Gamepad</th>
                        </tr>
                        <tr>
                            <td>Navigate</td>
                            <td>WASD / Arrows</td>
                            <td>D-Pad / Left Stick</td>
                        </tr>
                        <tr>
                            <td>Select / Attack</td>
                            <td>WASD (into neighbor) / Enter / E</td>
                            <td>A Button</td>
                        </tr>
                        <tr>
                            <td>Cancel / Deselect</td>
                            <td>Q</td>
                            <td>B Button</td>
                        </tr>
                        <tr>
                            <td>End Turn</td>
                            <td>Space / R</td>
                            <td>Y Button</td>
                        </tr>
                        <tr>
                            <td>Camera Pan</td>
                            <td>I J K L</td>
                            <td>Right Stick</td>
                        </tr>
                    </table>
                </section>

                <section>
                    <h3>SYSTEM CONFIGURATION</h3>
                    <div class="setting-explain">
                        <p><strong>Config:</strong></p>
                        <ul>
                            <li><em>Map Size:</em> Controls the dimensions of the grid. Larger maps take longer to
                                conquer.</li>
                            <li><em>Map Style:</em> Shape of the world (e.g., Continents, Maze, Swiss Cheese). Affects
                                movement paths.</li>
                            <li><em>Start Mode:</em> "Classic" gives each player a reasonable amount of dice, but the
                                later you start the more dice you get (+1 per player).
                                "Fair Start" gives everyone equal. "2 of 2": every country has 2 dices, "full madness":
                                every country is fully stacked.</li>
                            <li><em>Max Dice:</em> The maximum number of dice a single tile can hold.</li>
                            <li><em>Dice Sides:</em> A normal dice has 6 sides. Here you can change that. Values always
                                start with 1,2,3,...</li>
                            <li><em>Humans:</em> Set number of human players.</li>
                            <li><em>Bots:</em> Set number of AIs</li>
                            <li><em>Game Speed:</em> <strong>Beginner</strong> shows all rolls and animations.
                                <strong>Normal</strong> is standard. <strong>Expert</strong> skips most animations.
                            </li>
                            <li><em>Visual Effects:</em> "High" for full neon glow with particles. "Low/Off" for better
                                performance on
                                slow devices.</li>
                        </ul>
                    </div>
                </section>

                <section>
                    <h3>ABOUT</h3>
                    <div class="setting-explain">
                        <p>This game was made by <strong>Alexander Thurn</strong>.</p>
                        <p>It is <strong>open source</strong> and free to use and modify under the <strong>MIT
                                License</strong>.</p>
                        <p>GitHub: <a href="https://github.com/alexanderthurn/diception" target="_blank"
                                class="about-link highlight-link">alexanderthurn/diception</a></p>
                        <p>Visit <a href="https://feuerware.com" target="_blank"
                                class="about-link  highlight-link">feuerware.com</a>
                            for more games.</p>
                    </div>
                </section>
            </div>
        </div>

        <div id="player-dashboard" class="panel game-ui hidden">
            <h3 class="dash-header" id="dash-header">
                <span id="player-turn">Initializing...</span>
                <span id="dash-toggle">[-]</span>
            </h3>
            <div id="dash-content">
                <div id="player-list">
                    <!-- Populated by JS -->
                </div>
                <hr class="dash-divider">
                <h4 class="log-title">BATTLE LOG</h4>
                <div id="log-entries">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <div id="game-over-modal" class="modal hidden">
            <h1>GAME OVER</h1>
            <p id="winner-text"></p>
            <div id="highscore-section">
                <h3 class="highscore-title">üèÜ PLAYER STATS</h3>
                <div id="highscore-list"></div>
                <div id="total-games-played" class="total-games"></div>
            </div>
            <button id="restart-btn" class="tron-btn">Play Again</button>
        </div>

        <!-- AI Editor Modal -->
        <div id="ai-editor-modal" class="modal hidden large-modal">
            <div class="modal-header">
                <h2 class="tron-title small">AI EDITOR</h2>
                <button id="ai-editor-close-btn" class="close-btn">√ó</button>
            </div>
            <div class="ai-editor-content">
                <div class="ai-editor-left">
                    <div class="ai-list-section">
                        <h4>Your AIs</h4>
                        <div id="ai-list"></div>
                        <button id="new-ai-btn" class="tron-btn small">+ New AI</button>
                    </div>
                </div>
                <div class="ai-editor-right">
                    <div class="ai-name-row">
                        <input type="text" id="ai-name-input" placeholder="AI Name" maxlength="30">
                        <div class="ai-editor-actions">
                            <button id="test-ai-btn" class="tron-btn small" title="Test AI">‚ñ∂ Test</button>
                            <button id="save-ai-btn" class="tron-btn small" title="Save AI">üíæ Save</button>
                            <button id="delete-ai-btn" class="tron-btn small danger" title="Delete AI">üóëÔ∏è</button>
                        </div>
                    </div>
                    <textarea id="ai-code-input" placeholder="// Your AI code here..." spellcheck="false"></textarea>

                    <div id="ai-test-results" class="ai-test-results hidden">
                        <button id="ai-test-close-btn" class="ai-test-close-btn">√ó</button>
                        <h4>üèÜ Benchmark Results</h4>
                        <div id="ai-test-status"></div>
                        <table id="ai-test-table" class="benchmark-table">
                            <thead>
                                <tr>
                                    <th>Opponent</th>
                                    <th>Wins</th>
                                    <th>Draws</th>
                                    <th>Losses</th>
                                    <th>Win Rate</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="ai-prompt-section">
                        <h4>ü§ñ AI Prompt Generator</h4>
                        <textarea id="ai-prompt-input"
                            placeholder="Describe your strategy, e.g.: 'Make an aggressive AI that always attacks when it has more dice, but never attacks tiles with 8+ dice'"></textarea>
                        <button id="generate-prompt-btn" class="tron-btn small">üìã Copy Prompt to Clipboard</button>
                    </div>

                    <div class="ai-import-export">
                        <button id="export-ai-btn" class="tron-btn small">üì§ Export</button>
                        <button id="import-ai-btn" class="tron-btn small">üì• Import</button>
                    </div>
                </div>
            </div>

            <div class="ai-api-docs collapsible">
                <h4 class="collapsible-header">üìñ API Reference <span class="toggle-icon">‚ñº</span></h4>
                <div class="collapsible-content">
                    <div class="api-section">
                        <strong>Game State:</strong>
                        <ul>
                            <li><code>api.getMyTiles()</code> ‚Üí [{x, y, dice, owner}] - Your tiles</li>
                            <li><code>api.getEnemyTiles()</code> ‚Üí Enemy tiles</li>
                            <li><code>api.getAllTiles()</code> ‚Üí All playable tiles</li>
                            <li><code>api.getAdjacentTiles(x, y)</code> ‚Üí Neighboring tiles</li>
                            <li><code>api.getTileAt(x, y)</code> ‚Üí Specific tile or null</li>
                            <li><code>api.myId</code>, <code>api.maxDice</code>, <code>api.diceSides</code></li>
                            <li><code>api.mapWidth</code>, <code>api.mapHeight</code> ‚Üí Map dimensions</li>
                            <li><code>api.players</code> ‚Üí Array of all players [{id, alive, storedDice}]</li>
                        </ul>
                    </div>
                    <div class="api-section">
                        <strong>Strategy Helpers:</strong>
                        <ul>
                            <li><code>api.getLargestConnectedRegion(playerId)</code> ‚Üí Size of largest connected
                                territory</li>
                            <li><code>api.getReinforcements(playerId)</code> ‚Üí Total reinforcements (region + stored
                                dice)</li>
                            <li><code>api.getPlayerInfo(playerId)</code> ‚Üí Player object or null</li>
                            <li><code>api.simulateAttack(fromX, fromY, toX, toY)</code> ‚Üí Predict attack outcome without
                                executing:<br>
                                Returns {success, expectedWin, myPredictedReinforcements, enemyPredictedReinforcements}
                            </li>
                        </ul>
                    </div>
                    <div class="api-section">
                        <strong>Actions:</strong>
                        <ul>
                            <li><code>api.attack(fromX, fromY, toX, toY)</code> ‚Üí {success, expectedWin}</li>
                            <li><code>api.endTurn()</code> - End your turn</li>
                        </ul>
                    </div>
                    <div class="api-section">
                        <strong>Storage:</strong>
                        <ul>
                            <li><code>api.save(key, value)</code> - Persist data between games</li>
                            <li><code>api.load(key)</code> - Load persisted data</li>
                        </ul>
                    </div>
                    <div class="api-section">
                        <strong>Utilities:</strong>
                        <ul>
                            <li><code>api.log(msg)</code> - Debug output to console</li>
                            <li><code>api.getWinProbability(attackDice, defendDice)</code> ‚Üí 0-1 probability</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tournament Results Modal -->
        <div id="tournament-results-modal" class="modal hidden">
            <div class="modal-header">
                <h2 class="tron-title small">TOURNAMENT RESULTS</h2>
                <button id="tournament-close-btn" class="close-btn">√ó</button>
            </div>
            <div id="tournament-results"></div>
            <div class="tournament-actions">
                <button id="tournament-again-btn" class="tron-btn">Run Again</button>
                <button id="tournament-done-btn" class="tron-btn">Done</button>
            </div>
        </div>

        <!-- Scenario Browser Modal -->
        <div id="scenario-browser-modal" class="modal hidden wide-modal">
            <div class="modal-header compact-header">
                <div class="scenario-tabs header-tabs">
                    <button class="scenario-tab active" data-tab="maps">üó∫Ô∏è Maps</button>
                    <button class="scenario-tab" data-tab="scenarios">‚≠ê Scenarios</button>
                    <button class="scenario-tab" data-tab="replays">‚è™ Replays</button>
                </div>
                <button id="scenario-browser-close-btn" class="close-btn">√ó</button>
            </div>
            <div class="scenario-browser-content split-view">
                <div class="scenario-browser-left">
                    <div class="scenario-list-container">
                        <div id="scenario-list"></div>
                    </div>
                    <div class="scenario-left-actions">
                        <button id="scenario-import-btn" class="tron-btn small">üì• Import</button>
                        <button id="scenario-editor-btn" class="tron-btn small" title="Open Map Editor">‚úèÔ∏è
                            Editor</button>
                    </div>
                </div>
                <div class="scenario-browser-right">
                    <div id="scenario-preview-content">
                        <!-- Preview content injected here -->
                        <div class="empty-message-large">
                            Select a scenario to view details
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save Scenario Modal -->
        <div id="save-scenario-modal" class="modal hidden">
            <div class="modal-header">
                <h2 class="tron-title small">SAVE SCENARIO</h2>
                <button id="save-scenario-close-btn" class="close-btn">√ó</button>
            </div>
            <div class="save-scenario-content">
                <div class="control-group">
                    <label>Scenario Name</label>
                    <input type="text" id="scenario-name-input" placeholder="My Epic Battle" maxlength="40">
                </div>
                <div class="save-scenario-info">
                    <p>This will save the current game state including:</p>
                    <ul>
                        <li>Map layout and size</li>
                        <li>All player positions and dice counts</li>
                        <li>Player colors and types</li>
                    </ul>
                </div>
                <div class="save-scenario-actions">
                    <button id="save-scenario-confirm-btn" class="tron-btn">üíæ Save</button>
                    <button id="save-scenario-cancel-btn" class="tron-btn small">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>

</html>